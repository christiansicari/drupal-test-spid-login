# Runnare ISP di Prova
https://github.com/italia/spid-saml-check

```bash
docker run -t -i -p 8088:8443 italia/spid-saml-check:1.9.0
```

# Drupal
verificare sia settata private nel settings.php
```bash
$settings['file_private_path'] = '/home/private'; // o qualche altro path
```
Settare il proprietato della cartella appena associata a file_private_path a www-data:www-data
installare modulo: https://www.drupal.org/project/microspid

Dalle configurazioni del modulo:
1. creare cerficato
2. riempire campi obbligatori anagrafici.
3. Abilitare idp id test

## Workflow login:
Il modulo attualmente segue il seguente flusso. 
1. Il bottone di login carica gli ISP provider tramite l'elenco contenuto in: /opt/drupal/web/modules/contrib/microspid/microspid.module
2. Il metadata dell'ISP viene prelevato in /opt/drupal/web/modules/contrib/microspid/src/Service/SpidPaswManager.php riga 1100
3. testare login
4. inserire come credenziali validator:validator
5. sulla pagina metadata inserire URL della pagina drupal con i metadati presente nella conf del modulo tipo (https://url.it/microspid_metadata)
6. Andare in response e modificare la voce Issuer inserendo l'URI del ISP locale raggiungibile a drupal inserito nell'elenco sottostante al punto 2, es https://example.com:8088
8. enjoy


## Cosa modificare
1. Scaricare il file dell'ISP di test all'indirizzo https://localhost:8088/metadata.xml. Sostituire all'interno del file "localhost:8088" con un indirizzo raggiungibile dall'istanza drupal che deve usare il metadata es: https://example.com:8088
2. Copiare su /opt/drupal/web/modules/contrib/microspid/metadata/testenv2.xml il file metadata modificato al punto 1

Note
L'associazione con l'ISP viene fatta su /opt/drupal/web/modules/contrib/microspid/src/Service/SpidPaswManager, a riga 1100 tramite un 
dizionario, in questo caso il file testenv2.xml è associato a localhost:8088 che viene inviato dal form di login al click del tasto
login. Non ci interessa che dica localhost nel form, perchè 'indirizzo dell'ISP viene caricato dal metadata.xml





